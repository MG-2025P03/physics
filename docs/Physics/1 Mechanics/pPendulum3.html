<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Interactive Forced Damped Pendulum Simulation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.11.1.min.js"></script>
    <style>
        #controls {
            margin-bottom: 20px;
        }
        #plots {
            display: flex;
            flex-wrap: wrap;
        }
        .plot {
            width: 48%;
            margin: 1%;
        }
    </style>
</head>
<body>
    <h1>Interactive Forced Damped Pendulum Simulation</h1>
    <div id="controls">
        <label>g (gravity): <input type="range" id="gravity" min="1" max="20" value="9.81" step="0.01"> <span id="gravityValue">9.81</span></label><br>
        <label>L (length): <input type="range" id="length" min="0.5" max="5" value="1" step="0.01"> <span id="lengthValue">1.00</span></label><br>
        <label>beta (damping): <input type="range" id="damping" min="0" max="2" value="0.1" step="0.01"> <span id="dampingValue">0.10</span></label><br>
        <label>F0 (driving force): <input type="range" id="drivingForce" min="0" max="1" value="0.2" step="0.01"> <span id="drivingForceValue">0.20</span></label><br>
        <label>omegaDrive (frequency): <input type="range" id="drivingFrequency" min="0" max="2" value="0.67" step="0.01"> <span id="drivingFrequencyValue">0.67</span></label><br>
        <label>dt (time step): <input type="range" id="timeStep" min="0.01" max="0.1" value="0.02" step="0.01"> <span id="timeStepValue">0.02</span></label><br>
        <label>Simulation Time: <input type="range" id="simulationTime" min="10" max="120" value="60" step="1"> <span id="simulationTimeValue">60</span></label><br>
    </div>

    <div id="plots">
        <div id="phaseDiagram" class="plot"></div>
        <div id="energyPlot" class="plot"></div>
        <div id="harmonicMotion" class="plot"></div>
        <div id="pendulumComparison" class="plot"></div>
    </div>

    <script>
        // Initial Parameters
        let params = {
            g: 9.81,
            L: 1.0,
            beta: 0.1,
            F0: 0.2,
            omegaDrive: 0.67,
            dt: 0.02,
            totalSimulationTime: 60
        };

        // DOM Elements for input and display
        const controls = {
            gravity: document.getElementById('gravity'),
            length: document.getElementById('length'),
            damping: document.getElementById('damping'),
            drivingForce: document.getElementById('drivingForce'),
            drivingFrequency: document.getElementById('drivingFrequency'),
            timeStep: document.getElementById('timeStep'),
            simulationTime: document.getElementById('simulationTime')
        };

        const displayValues = {
            gravity: document.getElementById('gravityValue'),
            length: document.getElementById('lengthValue'),
            damping: document.getElementById('dampingValue'),
            drivingForce: document.getElementById('drivingForceValue'),
            drivingFrequency: document.getElementById('drivingFrequencyValue'),
            timeStep: document.getElementById('timeStepValue'),
            simulationTime: document.getElementById('simulationTimeValue')
        };

        // Function to update parameter values based on user input
        Object.keys(controls).forEach(key => {
            controls[key].addEventListener('input', (event) => {
                params[key] = parseFloat(event.target.value);
                displayValues[key].textContent = event.target.value;
                simulateAndPlot();
            });
        });

        // Simulate the pendulum dynamics
        function simulateAndPlot() {
            let theta = 0.5;
            let omega = 0;
            let timeData = [];
            let thetaData = [];
            let omegaData = [];
            let energyData = [];

            for (let t = 0; t < params.totalSimulationTime; t += params.dt) {
                timeData.push(t);
                // Equations of motion
                const thetaDoubleDot = (-params.g / params.L) * Math.sin(theta) - params.beta * omega + params.F0 * Math.cos(params.omegaDrive * t);
                omega += thetaDoubleDot * params.dt;
                theta += omega * params.dt;
                
                thetaData.push(theta);
                omegaData.push(omega);

                // Energy calculations
                const KE = 0.5 * params.L * params.L * omega * omega;
                const PE = params.g * params.L * (1 - Math.cos(theta));
                energyData.push({ time: t, kinetic: KE, potential: PE });
            }

            plotGraphs({timeData, thetaData, omegaData, energyData});
        }

        // Plot the graphs based on simulation data
        function plotGraphs(data) {
            // Phase Diagram
            const phaseTrace = {
                x: data.thetaData,
                y: data.omegaData,
                mode: 'lines',
                name: 'Phase Diagram'
            };
            Plotly.newPlot('phaseDiagram', [phaseTrace], { title: 'Phase Diagram (θ vs ω)' });

            // Energy vs. Time
            const energyTimeTrace = {
                x: data.timeData,
                y: data.energyData.map(e => e.kinetic + e.potential),
                mode: 'lines',
                name: 'Total Energy'
            };
            Plotly.newPlot('energyPlot', [energyTimeTrace], { title: 'Energy vs Time' });

            // Harmonic Motion in 1D
            const harmonicTrace = {
                x: data.timeData,
                y: data.thetaData,
                mode: 'lines',
                name: 'Harmonic Motion'
            };
            Plotly.newPlot('harmonicMotion', [harmonicTrace], { title: 'Harmonic Motion in 1D' });

            // Pendulum Approximation Comparison
            const fullTrace = {
                x: data.timeData,
                y: data.thetaData.map(theta => Math.sin(theta)),
                mode: 'lines',
                name: 'sin(θ)'
            };
            const approxTrace = {
                x: data.timeData,
                y: data.thetaData.map(theta => theta), // Small angle approximation
                mode: 'lines',
                name: 'θ (approximation)'
            };
            Plotly.newPlot('pendulumComparison', [fullTrace, approxTrace], { title: 'Pendulum Motion' });
        }

        // Initial simulation and plot
        simulateAndPlot();
    </script>
</body>
</html>